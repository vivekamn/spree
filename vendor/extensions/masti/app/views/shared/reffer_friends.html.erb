<%= javascript_include_tag "utils" %>
<script type="text/javascript">
        function showPlaxoChooser(){
            showPlaxoABChooser('recipient_list', '/shared/plaxo_cb');
            return false;
        }
    </script>
    <script type="text/javascript" src="/javascripts/plaxo/util.js">
    </script>
    <script type="text/javascript" src="/javascripts/plaxo/basic.js">
    </script>
    <script type="text/javascript" src="/javascripts/plaxo/abc_launcher.js">
    </script>
 	<script type="text/javascript">
      function onABCommComplete() {
        // grab all of the emails from Plaxo
        // ADJUST TO POINT TO YOUR TEXTAREA
        var emails = document.getElementById('recipient_list').value;
        // strip out all of the names associated with emails
        emails = emails.match(/<([^>]+)>/g).join(', ');
        // strip out the opening and closing brackets
        emails = emails.replace(/[<>]/g,'');

        // ADJUST TO POINT TO YOUR TEXTAREA
        document.getElementById('recipient_list').value = emails;
      }
    </script>
	<link href="/stylesheets/all.css" rel="stylesheet" type="text/css" />
<style>
	img{
		border:0px;
	}
    .bluebox {
        background: none repeat scroll 0 0 #DBEBFF;
        font-size: 125% !important;
        margin-bottom: 1em;
        padding: 0.5em 0.5em 0.5em 10px;
        -moz-box-shadow: 2px 2px 3px rgba(136, 136, 136, 0.24);
        border: 2px solid #75A1F8;
        color: #000000;
    }
    
	 .greenbox {
        background: none repeat scroll 0 0 #D7FFD7;
        font-size: 125% !important;
        margin-bottom: 1em;
        padding: 5px 5px 40px 10px;
        -moz-box-shadow: 2px 2px 3px rgba(136, 136, 136, 0.24);
        border: 2px solid #02D402;
        color: #000000;
		text-align:center;
    }
    .clear-left {
        clear: left;
    }
    
    .column {
        float: left;
        margin-right: 0.25em;
    }
    
    .column.share {
        padding-left: 10px;
        text-align: center;
        width: 25%;
    }
    
    .column.left {
        font-size: 90%;
        padding-top: 6px;
        width: 70%;
    }
	
	.column.left1 {
        font-size: 90%;
        padding-top: 6px;
		padding-bottom: 6px;
		width:100%;
		
    }
</style>
<table class="static_page" width="95%"  border="0" cellpadding="0" cellspacing="10" align="center" >
    <tr>
        <td width="100%" align="center" style="font-size:200%;color:#983F96;">
            Masthideals is more fun with friends.
        </td>
    </tr>
    <tr>
        <td align="center">
        	<table width="100%">
		<%if !current_user.nil? and !current_user.source.nil? and !current_user.source.empty?%>
			<% if !EMAIL_CAMP[current_user.source].nil? %>
			  <tr>
			  	<td colspan="2">
			  		<div id="" class="" style="width:98%">
			  			<p style="margin-left:15px;"> 
						 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Congrats!</span>  You have become a member of  Star Customer Club. You will get 3 - 10% addtional discount* and access to Exclusive deals for Star Customer Club.
						  &nbsp;&nbsp;You can win an Iphone* by inviting your friends to register with
						<span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Masthi</span> <span class='blue' style='font-size:18px;font-weight:bold;'>Deals.com.</span>
						  &nbsp;&nbsp; So go ahead and invite your friends to win an <span class='blue' style='font-size:18px;font-weight:bold;'>Iphone</span>.
						<br/>
						 </p>
			  		</div>
			  	</td>
			 </tr>
			<%elsif !current_user.nil? and !EMAIL_CAMP_ADD[current_user.source].nil?%>
				<tr>
				  	<td colspan="2">
				  		<div id="" class="" style="width:98%">
				  			<p style="margin-left:15px;"> 
							 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Congrats!</span>  You have earned 50 Rs to buy any deal in 
							 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Masthi</span> <span class='blue' style='font-size:18px;font-weight:bold;'>Deals.com!</span>
							  &nbsp;&nbsp;You can win an Iphone by inviting your friends to register with 
							<span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Masthi</span> <span class='blue' style='font-size:18px;font-weight:bold;'>Deals.com.</span>
							  &nbsp;&nbsp; So go ahead and invite your friends to win an <span class='blue' style='font-size:18px;font-weight:bold;'>Iphone</span>.
							<br/>
							 </p>
				  		</div>
				  	</td>
			  	</tr>
			<%end%>
		  
		  <%elsif params[:from]=='reg_complete_md_ref'%>
		  	<tr>
		  	<td colspan="2" align="center">
		  		<div id="" class="" style="width:98%">
		  			<p style="margin-left:-3px;"> 
					 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Hurray!</span>
					 You have earned 
					 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>50 MD</span> <span class='blue' style='font-size:18px;font-weight:bold;'> Money!</span>
					  You will get a ticket to 
					 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Inox</span> <span class='blue' style='font-size:18px;font-weight:bold;'> Movies</span>
					 if five of your friends successfully register with us.
					  <br/><br/>Go ahead and Invite them. Your friends will get 
					  <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>50 MD</span> <span class='blue' style='font-size:18px;font-weight:bold;'> Money</span>
					   when they register with MasthiDeals.com 
					 </p>
		  		</div>
		  	</td>
		  </tr>
		  <%else%>
		  <tr>
		  	<td colspan="2" align="center">
		  		<div id="" class="" style="width:98%">
		  			<p style="margin-left:10px;"> 
					  You will get a ticket to 
					 <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Inox</span> <span class='blue' style='font-size:18px;font-weight:bold;'> Movies</span>
					 if five of your friends successfully register with us.
					  <br/><br/>Go ahead and 
					  <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>Invite</span> <span class='blue' style='font-size:18px;font-weight:bold;'> them</span>
					  . Your friends will get 
					  <span class='green' style='margin-left:0px;font-size:18px;font-weight:bold;'>50 MD</span> <span class='blue' style='font-size:18px;font-weight:bold;'> Money</span>
					   when they register with MasthiDeals.com 
					 </p>
		  		</div>
		  	</td>
		  </tr>
	      <%end%>
        	</table>
            </p>
        </td>
    </tr>
    <tr>
        <td align="center">
        	<table width="80%">
        		<tr>
        			<td>
        				<div class="bluebox">
                <div class="column left">
                    Just click and share about MasthiDeals in Facebook and Twitter and get Rewards for every signup.
                </div>
                <div class="column share">
                    <a href="http://www.facebook.com/sharer.php?u=http://www.masthideals.com/?r=<%= @refferer.code %>&t=Masthideals.com" target="_blank"><img src="https://images.homerun.com/images/shared/share-button-fb.png?1266879606" class="fb-share highlight"></a>
					<a href="http://twitter.com/home?status=I find great deals from Restaurants, Spas, Resorts, Movie Tickets etc in http://www.masthideals.com/?r=<%= @refferer.code %> . Please check this link." title="Click to send this page to Twitter!" target="_blank">
						<img src="https://images.homerun.com/images/shared/share-button-twitter.png?1266879606" class="twitter-share highlight" style="padding-left:5px;">
					</a>
                </div>
                <div class="clear-left">
                </div>
            </div>
        			</td>
        		</tr>
        	</table>
            
        </td>
    </tr>
	<tr>
		<td align="center">
        	<table width="80%">
        		<tr>
        			<td>
        				<div class="greenbox">
                <div class="column left1">
                    Send this message to your friends and get Rewards for every successful signup.
                </div>
                <div>
                   <input type="text" value="http://www.masthideals.com/?r=<%= @refferer.code %>" readonly="readonly" id="url" onclick="select_all(this)"  data-size="medium" size="50">
                </div>
		<% if current_user.nil?%>
		 <div class="column left1">
                    Your Email id : <%= @email %>. <a href="<%=invite_friends_path(:flag=>'1')%>">Want to change?</a>
                </div>		
                <%end%>
		</div>
        			</td>
        		</tr>
        	</table>
            
        </td>
	</tr>
	<tr>
		<td align="center">
        	<table width="80%">
        		<tr>
        			<td>
        				<div style="background-color: rgb(255, 255, 255); border: 2px solid rgb(41, 104, 158);">
							<% form_for :connections ,:url => {:controller =>'shared' , :action => 'plaxo_invite'}, :html => {:id => "plaxo_invite_submit"} do |f| %>
							<table width="100%" border="0" cellpadding="0" cellspacing="0" style="padding-top:10px;padding-bottom:10px;padding-left:10px;">
								<tr>
									<td colspan="3" align="center">
										<%= image_tag '/images/addressBook_btn.jpg', :onclick => "showPlaxoChooser();", :border => '0', :width => '216px', :height => '44px', :alt => "Add from my address book", :class  => "cursor_pointer" %>	
									</td>
								</tr>
								<tr height="10px">
									
								</tr>
								<tr>
									<td valign="middle">
										Name <font style="color:red"> * </font>: <input type="text" id="name" name="name" size="38" onkeyup="set_name(this);" class="textbox"><br/>
							           <div id="name_msg_div" style="display:none;padding-left:50px;"></div>	
									</td>
									<td valign="middle">
										Your Friends Email-id <font style="color:red"> * </font>:	
									</td>
									<td valign="top">
										<textarea id="recipient_list" name="recipients" onfocus="clear_recipient_list_div();" class="textarea"></textarea><br />
                                         <div id="recipient_list_div" style="display:none;"></div>
									</td>
								</tr>
								<tr>
									<td colspan="3" align="center">
										<div id="change_image_plaxo">
                            	<input type="button" onclick="validate_plaxo_invite();" value="Send" class="forward_but">
                            </div>    	
									</td>
								</tr>
							</table>
							<%end%>
            			</div>
        			</td>
        		</tr>
        	</table>
            
        </td>
	</tr>
</table>

<script type="text/javascript">    
  function select_all(obj) {
  var text_val=eval(obj);
  text_val.focus();
  text_val.select();
  }

    function set_messages(inputs){
        document.getElementById('invite_from').innerHTML = inputs.value;
    }
	function set_name(inputs){
        document.getElementById('invite_from_name').innerHTML = inputs.value;
    }
	function validate_plaxo_invite(){		
		var recipient_list_field = document.getElementById('recipient_list').value;
		var msg_recipient_list = document.getElementById('recipient_list_div');		
		var name_box = document.getElementById('name').value;
		document.getElementById("name_msg_div").style.display = "none";
		msg_recipient_list.style.display = "none";
		if(recipient_list_field.length != 0 && name_box.length !=0){
			var change = document.getElementById('change_image_plaxo');
			change.innerHTML = "<img src='/images/ajax_loader.gif' />";
			new Ajax.Request('/shared/check_email_plaxo?recipients='+recipient_list_field, {asynchronous:true, evalScripts:true, onComplete:function(request){
				if(request.responseText == "valid"){
					document.getElementById('plaxo_invite_submit').submit();
				}else{
					change.innerHTML = "<input type='button' onclick='validate_plaxo_invite();' value='Send' class='forward_but' style='background-color: rgb(168, 208, 39);'/>";
					msg_recipient_list.innerHTML = "<font color='red'>Invalid Email id.<\/font>";
					msg_recipient_list.style.display = "block";
				}
			}});
		}else{
			if(name_box.length==0){
				document.getElementById("name_msg_div").innerHTML="<font color='red'>Name should not be empty.</font>";
				document.getElementById("name_msg_div").style.display = "block";
			}
			if(recipient_list_field.length==0){
				msg_recipient_list.innerHTML = "<font color='red'>Email-Id should not be empty.<\/font>";
				msg_recipient_list.style.display = "block";
			}
			
		
		}
	}
	function clear_recipient_list_div(){
		document.getElementById('recipient_list_div').style.display = "none";
	}
</script>
