<%= javascript_include_tag "prototype" %>
<div class="flash errors" id="flash_error" style="display:none;">
</div>
<div class="bannerouter">
  <div class="shoppingout">
    <div class="shoppingleft">
      <table width="100%" height="230" border="0" cellpadding="0" cellspacing="0">
        <tr>
          <td height="51" colspan="3"  style="padding-bottom: 28px;">
            <img src="/images/newcustomer.gif" width="233" height="35" />
          </td>
        </tr>
        <tr>
          <td width="30%" height="35">
            Email 
            <font color="red">
              *
            </font>
          </td>
          <td width="4%" height="35">
            :
          </td>
          <td width="66%">
            <div style="float:left;">
              <%= f.text_field :email, :class=>"textbox",:onblur=>"javascript:unique_email();" %>
            </div>
            <div id="email_image" style="float:right;">
            </div>
          </td>
        </tr>
        <tr>
          <td width="30%" height="35">
            Password 
            <font color="red">
              *
            </font>
          </td>
          <td width="4%" height="35">
            :
          </td>
          <td width="66%">
            <div id="password-credentials" style="<%=password_style(@user)%>">
              <%= f.password_field :password, :class=>"textbox" %>
            </div>
          </td>
        </tr>
        <tr>
          <td width="36%" height="35">
            Confirm Password
            <font color="red">
              *
            </font>
          </td>
          <td width="4%" height="35">
            :
          </td>
          <td width="60%">
            <div id="password-credentials" style="<%=password_style(@user)%>">
              <%= f.password_field :password_confirmation,:class=>"textbox" %>
            </div>
          </td>
        </tr>
        <tr>
          <td width="30%" height="35">
            Moblie 
            <font color="red">
              *
            </font>
          </td>
          <td width="4%" height="35">
            :+91
          </td>
          <td width="66%">
            <%= f.text_field :phone_no, :class=>"textbox" %>
          </td>
        </tr>
        <tr>
          <td height="61" colspan="3" align="right" style="padding-right:39px">
            <p>
            <%= image_submit_tag "submit1.gif", :alt => 'submit_btn', :class  => "cursor_pointer", :id => "submit_btn",:onclick => "return user_validate();" %>
            </p>
            <span class='login_exists'><%= link_to "<span class='green' style='font-size:16px; font-weight:bold;'>Log In as</span> <span class='blue' style='font-size:16px; font-weight:bold;'>Existing Customer</span>", login_path %></span>
          </td>
        </tr>
        <tr>
          <td>
            &nbsp;
          </td>
          <td>
            &nbsp;
          </td>
          <td>
            &nbsp;
          </td>
        </tr>
      </table>
    </div>
    <div class="shoppingright">
      <img src="/images/shopping.gif" width="403" height="305" />
    </div>
  </div>
</div>
<script>
  var email_flag = true;
  function unique_email() {
    var email_name = document.getElementById('user_email').value;
    var EMAIL_REGEX = /^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i;
    var flag_em = true;
    var msg = '<ul style="margin-left:20px;">';
      if (email_name.length != 0) {
        email_my = new String(email_name);
        email_value = EMAIL_REGEX.test(email_my);
        if (email_value != true) {
          msg += '<br/>E-mail is invalid';
          document.getElementById('flash_error').style.display = '';
          document.getElementById('flash_error').innerHTML = msg;
          flag_em = false;
          email_flag = false;
        }
        else {
          document.getElementById('flash_error').style.display = 'none';
          document.getElementById('email_image').innerHTML = "<img src='/images/spinner.gif' border=0/>";
          new Ajax.Request('/home/unique_email?email=' + email_name, {
            asynchronous: true,
            evalScripts: true,
            onComplete: function(request){
              document.getElementById('flash_error').style.display = 'none';
              if (request.responseText == 'true') {
                email_flag = true;
                document.getElementById('email_image').innerHTML = '';
                document.getElementById('email_image').innerHTML = "<img src='/images/tick.jpg' border=0/>"
              }
              else {
                email_flag = false;
                document.getElementById('email_image').innerHTML = '';
                msg += 'Email has already been registered.<a href="password_resets/new">Forgot Password?</a>'
                document.getElementById('flash_error').style.display = '';
                document.getElementById('flash_error').innerHTML = msg;
              }
            }
          });
        }
      }
      else {
        msg += '<br/>E-mail can not be empty';
        flag_em = false;
        email_flag = false;        
          document.getElementById('flash_error').style.display = '';
          document.getElementById('flash_error').innerHTML = msg;
      }
    }

    

    function user_validate(){
      var email = document.getElementById('user_email').value;
      var password = document.getElementById('user_password').value;
      var confirm = document.getElementById('user_password_confirmation').value;
      var mobile = document.getElementById('user_phone_no').value;
      var msg = '';
      var PHONE_REGEX	= /^[0-9]+$/;
      var flag_user = true;

      if(email == '' || email == null){
        msg += '<br/>E-mail field cannot be empty';
        flag_user = false; 
      }
      else {
        if(email_flag == false)
        msg += '<br/>E-mail is invalid';
      }

      pass_str = new String(password)
      if(password == '' || password == null || confirm == '' || confirm == null || pass_str.length < 4){
        if(pass_str.length < 4){
			msg += '<br/>Password is invalid';
        	flag_user = false;
		}
		else{
			msg += '<br/>Password is invalid';
        	flag_user = false;
		}
      }
      else{
        if (password != confirm ){
          msg += '<br/>Password and confirm password doesnot match';
          flag_user = false;
        }
      }
      phone_value = PHONE_REGEX.test(new String(mobile)); 
      if(mobile =='' || mobile == null) {
        msg += '<br/>Phone No. field can not be empty';
        flag_user = false;
      } 
      else {
        if(phone_value != true) {
          msg += '<br/> Please give only numbers in the Phone No. field';
          flag_user = false;
        }
        else {
          if(new String(mobile).length != 10){
            msg += '<br/>Please check Phone No. has 10 digits';
            flag_user = false;
          }
        }
      }
      if(!flag_user) {
        msg += '</ul>'
      document.getElementById('flash_error').style.display='';
      document.getElementById('flash_error').innerHTML = msg;
      }else{
      document.getElementById('flash_error').style.display=none;
      error_msg_div.innerHTML = "";
    }
    return flag_user;
  }
</script>

